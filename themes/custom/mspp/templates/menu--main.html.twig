{#
/**
 * @file
 * Theme override to display a menu using Bootstrap 5 navbar.
 */
#}
{% import _self as menus %}

{#
  We call a macro which calls itself to render the full tree.
  @see https://twig.symfony.com/doc/3.x/tags/macro.html
#}
{{ menus.menu_links(items, attributes, 0) }}

{% macro menu_links(items, attributes, menu_level) %}
    {% import _self as menus %}
    {% if items %}
        {% if menu_level == 0 %}
            <div class="offcanvas offcanvas-end d-lg-none" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Menu</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav">
                        {% for item in items %}
                            {% set classes = [
                'nav-item',
                item.in_active_trail ? 'active',
              ] %}
                            <li{{item.attributes.addClass(classes)}}>
                                {% if item.is_expanded and item.below %}
                                    {% set collapse_id = 'collapse-' ~ loop.index %}
                                    <a href="#{{ collapse_id }}" class="nav-link dropdown-toggle collapsed" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="{{ collapse_id }}">{{ item.title }}</a>
                                    <div class="collapse" id="{{ collapse_id }}">
                                        <ul class="submenu-list">
                                            {{ menus.menu_links(item.below, attributes, menu_level + 1) }}
                                        </ul>
                                    </div>
                                {% else %}
                                    <a href="{{ item.url }}" class="nav-link{{ item.in_active_trail ? ' active' }}">{{ item.title }}</a>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            
            <nav class="navbar navbar-expand-lg d-none d-lg-block">
                <div class="container">
                    <div class="navbar-collapse">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            {% for item in items %}
                                {% set classes = [
                  'nav-item',
                  item.is_expanded ? 'dropdown',
                  item.is_collapsed ? 'collapsed',
                  item.in_active_trail ? 'active',
                ] %}
                                <li{{item.attributes.addClass(classes)}}>
                                    {% if item.is_expanded and item.below %}
                                        <a href="{{ item.url }}" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false">{{ item.title }}</a>
                                        <ul class="dropdown-menu">
                                            {{ menus.menu_links(item.below, attributes, menu_level + 1) }}
                                        </ul>
                                    {% else %}
                                        <a href="{{ item.url }}" class="nav-link{{ item.in_active_trail ? ' active' }}">{{ item.title }}</a>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </nav>
        {% else %}
            {% for item in items %}
                <li{{item.attributes.addClass('dropdown-item')}}>
                    <a href="{{ item.url }}">{{ item.title }}</a>
                    {% if item.below %}
                        {{ menus.menu_links(item.below, attributes, menu_level + 1) }}
                    {% endif %}
                </li>
            {% endfor %}
        {% endif %}
    {% endif %}
{% endmacro %}

