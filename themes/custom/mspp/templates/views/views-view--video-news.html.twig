{#
/**
 * @file
 * Theme override for the "L'actualité en vidéos" view with YouTube embeds.
 */
#}

<div class="row mb-4">
    <div class="col-lg-12">
        <h2 class="mb-0 text-lg-center p-2">L'actualité en vidéos</h2>
        <p class="text-lg-center p-2 lead">Découvrez les dernières actualités du Ministère de la Santé Publique et de la Population en vidéo.</p>
    </div>
</div>

{% if rows is not empty %}

  {# --------------------------------------------------------
     MACRO: Extract YouTube Video ID from any embed or URL
     -------------------------------------------------------- #}
  {% macro youtube_id(html) %}
{%- if html matches '/v=([A-Za-z0-9_-]+)/' -%}
{{ html|split('v=')[1]|split('&')[0]|split('"')[0]|trim }}
{%- elseif html matches '/youtu\\.be\\/([A-Za-z0-9_-]+)/' -%}
{{ html|split('youtu.be/')[1]|split('?')[0]|split('"')[0]|trim }}
{%- elseif html matches '/embed\\/([A-Za-z0-9_-]+)/' -%}
{{ html|split('embed/')[1]|split('?')[0]|split('"')[0]|trim }}
{%- else -%}
{%- endif -%}
  {% endmacro %}

  {% import _self as utils %}

  {% set total = view.result|length %}
  {% set max_items = 3 %}
  {% set items = total < max_items ? total : max_items %}

  <div class="row g-4">
    {% for i in 0..(items - 1) %}
      {% set html = view.style_plugin.getField(i, 'field_video_link')|striptags|trim %}
      {% set youtube = utils.youtube_id(html)|trim %}

      <div class="col-lg-4 col-md-6">
        <div class="card h-100 shadow-sm border-0">
          <div class="ratio ratio-16x9">
            <iframe
              src="https://www.youtube.com/embed/{{ youtube }}"
              title="{{ view.style_plugin.getField(i, 'title') }}"
              class="card-img-top"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen>
            </iframe>
          </div>
          <div class="card-body">
            <h5 class="card-title fw-semibold mb-3">{{ view.style_plugin.getField(i, 'title') }}</h5>
            <p class="card-text text-muted small">{{ view.style_plugin.getField(i, 'field_video_desc') }}</p>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

{% else %}
  <div class="alert alert-info text-center" role="alert">
    {{ empty }}
  </div>
{% endif %}