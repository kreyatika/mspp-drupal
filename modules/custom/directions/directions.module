<?php

/**
 * @file
 * Primary module hooks for Directions module.
 */

/**
 * Implements hook_theme().
 */
function directions_theme() {
  return [
    'directions_list' => [
      'variables' => [
        'directions' => NULL,
        'filter_terms' => NULL,
      ],
    ],
  ];
}

/**
 * Implements hook_theme_suggestions_HOOK_alter() for node templates.
 */
function directions_theme_suggestions_node_alter(array &$suggestions, array $variables) {
  $node = $variables['elements']['#node'];
  if ($node->bundle() == 'directions') {
    $suggestions[] = 'node__directions';
  }
}

/**
 * Implements hook_preprocess_node() for directions content type.
 */
function directions_preprocess_node(&$variables) {
  $node = $variables['node'];
  if ($node->bundle() == 'directions' && $variables['view_mode'] == 'full') {
    $variables['direction'] = [
      'id' => $node->id(),
      'title' => $node->label(),
      'mission' => $node->hasField('field_mission') && !$node->get('field_mission')->isEmpty() 
        ? $node->get('field_mission')->value : '',
      'directeur' => $node->hasField('field_le_directeur') && !$node->get('field_le_directeur')->isEmpty() 
        ? $node->get('field_le_directeur')->value : '',
      'photo' => $node->hasField('field_photo_du_directeur') && !$node->get('field_photo_du_directeur')->isEmpty() 
        ? \Drupal::entityTypeManager()->getViewBuilder('media')->view($node->get('field_photo_du_directeur')->entity, 'default') : NULL,
      'email' => $node->hasField('field_email') && !$node->get('field_email')->isEmpty() 
        ? $node->get('field_email')->value : '',
      'telephone' => $node->hasField('field_telephone') && !$node->get('field_telephone')->isEmpty() 
        ? $node->get('field_telephone')->value : '',
      'formation' => $node->hasField('field_formation') && !$node->get('field_formation')->isEmpty() 
        ? $node->get('field_formation')->value : '',
      'parcours' => $node->hasField('field_parcours') && !$node->get('field_parcours')->isEmpty() 
        ? $node->get('field_parcours')->value : '',
      'depuis' => $node->hasField('field_depuis') && !$node->get('field_depuis')->isEmpty() 
        ? $node->get('field_depuis')->value : '',
      'ne_a' => $node->hasField('field_ne_a') && !$node->get('field_ne_a')->isEmpty() 
        ? $node->get('field_ne_a')->value : '',
      'cadre_cles' => $node->hasField('field_cadre_cles') && !$node->get('field_cadre_cles')->isEmpty() 
        ? $node->get('field_cadre_cles')->value : '',
    ];
  }
}
